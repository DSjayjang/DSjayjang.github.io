---
layout: single
title: "dplyr in R"
categories: R
tag: [datamining, r, dplyr]
toc: true # 목차 보여주기
author_profile: false   # 프로필 제거
# sidebar:    # 프로필 제거 후 사이드바 보여주기
#     nav: "counts"
typora-root-url: ../
---
<br>

# ※ **데이터전처리 패키지: dplyr**				
- chain function : %>%				
    파이프연산자를 사용하여 매우 직관적임			
- 코드 가독성이 높음				
- 코드 유지보수가 용이함				
- 매우 빠른 속도				
- 사용법				
  - 변수명 %>% 함수1 %>% 함수2 %>% …			
                
```				
# 일반적인 코드				
> 함수3(함수2(함수1(df,x),y,z))				
```                
```                
# dplyr을 사용한 코드				
> df %>%				
    함수1(x) %>%				
    함수2(x) %>%				
    함수3(x) %>%				
    ...				
```				
                
<br>				
                
## ■ **filter**				
- 데이터 내에서 조건을 만족하는 행을 선택하여 출력				
- 사용법				
    - df %>% filter(조건)			
                
- 사용 예시				
```				
# 일반적인 코드				
## 성별이 남자인 데이터만 추출				
> df[gender == "M", ]				
```               
```
# dplyr을 사용한 코드				
## 성별이 남자인 데이터만 추출				
> df %>%				
    filter(gender == "M")				
                
## 성별이 남자이면서 점수가 90점 이상인 데이터만 추출				
> df %>%				
    filter(gender == "M" & score >= 90)				
```				
                
<br>				
                
## ■ **select**				
- 원하는 컬럼만 선택하여 출력				
- 사용법				
    - 데이터에서 컬럼A를 출력			
      - df %>% select(컬럼A)			
    - 데이터에서 컬럼A를 제외하고 출력			
      - df %>% select(-컬럼A)			
- 사용 예시				
```				
# df에서 컬럼 colA들 값 출력				
> df %>%				
    select(colA)				
                
# df에서 컬럼 colA~ colD들 값 출력				
> df %>%				
    select(colA : colD)				
                
# df에서 컬럼 colA와 colB를 제외하고 출력				
> df %>%				
    select(-colA, colB)				
```				
                
<br>				
                
## ■ **arrange**				
- 데이터를 오름/내림차순으로 정렬				
- 사용법				
    - 컬럼을 기준으로 오름차순 정렬			
      - df %>% arrange(컬럼)			
    - 컬럼을 기준으로 내림차순 정렬			
      - df %>% arrange(desc(컬럼))			
                
<br>				
                
## ■ **distinct**				
- 데이터 내에서 중복된 값을 제거하고 출력				
- 사용법				
    - 데이터 내의 해당 컬럼의 중복된 값 제거하고, **해당 컬럼만** 출력			
      - df %>% distinct(컬럼)			
    - 데이터 내의 해당 컬럼의 중복된 값을 제거하고, **모든 행** 출력			
      - df %>% distinct(컬럼, **.keep_all = TRUE**)			
    - 데이터 내의 해당 **중복된 행을 제거**하고 출력			
      - df %>% distinct()			
                
<br>				
                
## ■ **group_by**와 **summarize**				
- 데이터 내에서 특정 컬럼을 기준으로 요약한 값 출력				
- 사용법				
    - df %>% group_by(컬럼1) %>% summarize(함수(컬럼2))			
    - 데이터를 컬럼1을 기준으로, 컬럼2를 함수로 집계			
- 사용 예시				
```				
# 각 성별의 개수 출력				
> df %>%				
    group_by(gender) %>%				
    summarize(n())				
                
# 각 성별의 평균 점수 출력				
> df %>%				
    group_by(gender) %>%				
    summarize(mean(score))				
                
# 각 성별의 평균 점수와 합계 점수를 출력				
##평균 점수는 컬럼명(avg), 합계 점수는 컬럼명(sum)으로 출력				
> df %>%				
    group_by(gender) %>%				
    summarize(avg = mean(score),				
    sum = sum(score))				
```				
                
<br>				
                
## ■ **mutate**				
- 새로운 컬럼 생성				
- 사용법				
    - df %>% mutate(새로운 컬럼명 = 값1)			
    - 값1을 갖는 새로운 컬럼을 생성			
- 사용 예시				
```				
# 새로운 컬럼(sums) = col1 + col2 + col3				
# 새로운 컬럼(means) = sums들의 평균				
> df %>%				
    mutate(sums = col1 + col2 + col3,				
    means = sums/3)				
```				
                
<br>				
                
## ■ **sample_n**과 **sample_frac**				
- 데이터에서 행을 랜덤 샘플링 후 출력				
- 사용법				
    - 숫자만큼의 행을 랜덤 샘플링			
      - df %>% sample_n(숫자)			
    - 비율만큼의 행을 랜덤 샘플링			
      - df %>% sample_n(비율)			
- 사용 예시				
```				
# 10개의 행을 랜덤으로 뽑아서 출력				
> df %>%				
    sample_n(10)				
                
# 전체 데이터에서 30%의 행을 랜덤으로 뽑아서 출력				
> df %>%				
    sample_frac(0.3)				
```				
                
<br>				
                
## ■ **bind_rows**와 **bind_cols**				
### □ **bind_rows**				
- 데이터를 행으로 결합				
- 사용법				
    - df1과 df2를 행으로 결합(아래로 이어붙임)			
    - df1 %>% bind_rows(df2)			
                
<br>				
                
### □ **bind_cols**				
- 데이터를 열방향으로 결합				
- 사용법				
    - df1과 df2를 열방향 결합(옆으로 이어붙임)			
    - df1 %>% bind_cols(df2)			
<br>				
                
## ■ **join** 함수				
### □ **inner_join**				
- 특정 컬럼을 기준으로 결합(교집합)				
- 사용법				
    - df1과 df2를 기준열에 맞추어 교집행만 살려서 결합			
    - 만약 기준열이 같을 경우 by 인자는 생략 가능			
    - df1 %>% inner_join(df2, by = c("df1의 기준열 = df2의 기준열"))			
                
<br>				
                
### □ **full_join**				
- 특정 컬럼을 기준으로 결합(합집합)				
- 사용법				
    - df1과 df2를 기준열에 맞추어 모든 행을 살려서 결합			
    - 만약 기준열이 같을 경우 by 인자는 생략 가능			
    - df1 %>% full_join(df2, by = c("df1의 기준열 = df2의 기준열"))			
                
<br>				
                
### □ **left_join** / **right_join**				
- 특정 컬럼을 기준으로 결합				
- 사용법<br>				
    ◎ left_join			
    - df1과 df2를 기준열에 맞추어 df1의 행은 모두 살려서 결합			
    - df1 %>% left_join(df2, by = c("df1의 기준열 = df2의 기준열"))<br>
                
    ◎ right_join			
    - df1과 df2를 기준열에 맞추어 df2의 행은 모두 살려서 결합			
    - df1 %>% right_join(df2, by = c("df1의 기준열 = df2의 기준열"))			
